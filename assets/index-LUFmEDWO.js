import{r as h,a as ce,R as le}from"./vendor-wGySg1uH.js";import{r as de,u as $,w as G}from"./xlsx-CKN5doRT.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const p of a.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&n(p)}).observe(document,{childList:!0,subtree:!0});function s(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(o){if(o.ep)return;o.ep=!0;const a=s(o);fetch(o.href,a)}})();var Q={exports:{}},D={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ue=h,he=Symbol.for("react.element"),pe=Symbol.for("react.fragment"),me=Object.prototype.hasOwnProperty,xe=ue.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,fe={key:!0,ref:!0,__self:!0,__source:!0};function K(t,r,s){var n,o={},a=null,p=null;s!==void 0&&(a=""+s),r.key!==void 0&&(a=""+r.key),r.ref!==void 0&&(p=r.ref);for(n in r)me.call(r,n)&&!fe.hasOwnProperty(n)&&(o[n]=r[n]);if(t&&t.defaultProps)for(n in r=t.defaultProps,r)o[n]===void 0&&(o[n]=r[n]);return{$$typeof:he,type:t,key:a,ref:p,props:o,_owner:xe.current}}D.Fragment=pe;D.jsx=K;D.jsxs=K;Q.exports=D;var e=Q.exports,V={},H=ce;V.createRoot=H.createRoot,V.hydrateRoot=H.hydrateRoot;const ge=async t=>new Promise((r,s)=>{const n=new FileReader;n.onload=o=>{var a;try{const p=(a=o.target)==null?void 0:a.result,c=de(p,{type:"binary"}),i=c.Sheets[c.SheetNames[0]],y=$.sheet_to_json(i,{header:1}),x=[];if(y.length===0){r([]);return}const N=y[0],m=[];if(N.forEach((f,C)=>{f&&f.toString().includes("截图链接")&&m.push(C)}),m.length===0){console.warn('未找到包含"截图链接"字样的列'),r([]);return}const b=N.findIndex(f=>f&&f.toString().includes("正确答案"));for(let f=1;f<y.length;f++){const C=y[f];m.forEach(k=>{const g=C[k];if(g&&typeof g=="string"&&g.trim()){const u={url:g.trim(),rowIndex:f+1,columnName:N[k]};if(b!==-1&&C[b]!==void 0){const L=C[b];u.correctAnswer=Number(L)}x.push(u)}})}r(x)}catch(p){s(p)}},n.onerror=()=>{s(new Error("文件读取失败"))},n.readAsBinaryString(t)}),P="https://api.coze.cn/v1/workflow/run",je="pat_v6RwanL44Q047UNcfQVnvdBiS6VPfzFJQ4EeXy0gOLYNE3Ar1CsSGoka2tyksCyP",we="7577583987406471187",O=(t,r,s)=>{const n=new Error(t);return n.type=r,Object.assign(n,s),n},ke=async(t,r)=>{var s;try{const n=JSON.stringify({workflow_id:we,parameters:{rawUrl:t}});let o;try{o=await fetch(P,{method:"POST",headers:{Authorization:`Bearer ${je}`,"Content-Type":"application/json"},body:n,signal:r})}catch(c){throw c.name==="AbortError"?c:O(`网络请求失败: ${c.message}`,"network",{url:P,originalError:c})}if(!o.ok){let c={},i="";try{i=await o.text();try{c=JSON.parse(i)}catch{c={message:i}}}catch{c={}}throw c.code===4013?O(`请求频率超过限制: ${c.msg||"请降低请求频率"}`,"api",{statusCode:o.status,url:t,response:c,responseText:i,debugUrl:c.debug_url,logId:(s=c.detail)==null?void 0:s.logid}):O(`工作流API调用失败 (HTTP ${o.status})${c.msg?": "+c.msg:""}`,"api",{statusCode:o.status,url:t,response:c,responseText:i})}let a;try{a=await o.json(),console.log("Coze工作流调用成功，结果：",a)}catch(c){const i=await o.text();throw O(`响应JSON解析失败: ${c.message}`,"parse",{responseText:i,url:t,originalError:c})}let p;if(typeof a.data=="string")try{p=JSON.parse(a.data),console.log("data 字段是字符串，尝试解析",p)}catch(c){throw O(`工作流返回的data字段JSON解析失败: ${c.message}`,"parse",{data:a.data,url:t,originalError:c})}else if(a.data)p=a.data,console.log("data 字段不是字符串，直接使用",p);else throw O("工作流返回的数据中缺少 data 字段","data",{result:a,url:t});if(p.res)return p.res;throw O("解析后的数据中未找到 res 字段","data",{parsedData:p,url:t})}catch(n){throw console.error("Coze工作流调用失败:",n),n&&n.type?n:O(`未知错误: ${(n==null?void 0:n.message)||String(n)}`,"network",{url:t,originalError:n})}},ve=(t,r="处理结果")=>{const s=t.map((i,y)=>{let x="";switch(i.status){case"success":x="成功";break;case"error":x="失败";break;case"pending":x="待处理";break;case"processing":x="处理中";break;default:x="未知"}let N="";i.status==="success"&&i.result&&(typeof i.result=="object"&&i.result.lijie?N=i.result.lijie:typeof i.result=="string"?N=i.result:N=JSON.stringify(i.result));let m="";i.correctAnswer!==void 0&&(m=i.correctAnswer===1?"合格":"不合格");let b="";i.correctAnswer!==void 0&&i.isCorrect!==void 0&&(b=i.isCorrect?"正确":"错误");const f={序号:y+1,行号:i.rowIndex,列名:i.columnName,图片链接:i.url,处理状态:x,审核结果:N,标准答案:m,判断结果:b};return i.status==="error"&&i.error&&(f.错误信息=i.error),f}),n=$.book_new(),o=$.json_to_sheet(s),a=[{wch:6},{wch:8},{wch:15},{wch:50},{wch:10},{wch:30},{wch:10},{wch:10},{wch:30}];o["!cols"]=a,$.book_append_sheet(n,o,"处理结果");const p=new Date().toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).replace(/[/:]/g,"-").replace(/\s/g,"_"),c=`${r}_${p}.xlsx`;return G(n,c),c},ye=(t,r="处理摘要",s)=>{const n={总计:t.length,成功:t.filter(m=>m.status==="success").length,失败:t.filter(m=>m.status==="error").length,待处理:t.filter(m=>m.status==="pending").length,处理中:t.filter(m=>m.status==="processing").length},o={有标准答案总数:t.filter(m=>m.correctAnswer!==void 0&&m.status==="success").length,判断正确:t.filter(m=>m.isCorrect===!0).length,判断错误:t.filter(m=>m.isCorrect===!1).length},a=o.有标准答案总数>0?(o.判断正确/o.有标准答案总数*100).toFixed(2)+"%":"0.00%",p={总处理时间:s!=null&&s.totalTime?`${(s.totalTime/1e3).toFixed(2)}秒`:"未记录",平均每张处理时间:s!=null&&s.totalTime&&n.成功>0?`${(s.totalTime/1e3/n.成功).toFixed(2)}秒`:"未记录",开始时间:s!=null&&s.startTime?new Date(s.startTime).toLocaleString("zh-CN"):"未记录",结束时间:s!=null&&s.endTime?new Date(s.endTime).toLocaleString("zh-CN"):"未记录"},c=[{项目:"处理统计",数值:"",说明:""},{项目:"总计",数值:n.总计,说明:"所有数据条数"},{项目:"成功",数值:n.成功,说明:"处理成功的条数"},{项目:"失败",数值:n.失败,说明:"处理失败的条数"},{项目:"待处理",数值:n.待处理,说明:"尚未处理的条数"},{项目:"处理中",数值:n.处理中,说明:"正在处理的条数"},{项目:"",数值:"",说明:""},{项目:"准确率统计",数值:"",说明:""},{项目:"准确率",数值:a,说明:"判断正确的比例"},{项目:"有标准答案总数",数值:o.有标准答案总数,说明:"包含标准答案的数据条数"},{项目:"判断正确",数值:o.判断正确,说明:"与标准答案一致的条数"},{项目:"判断错误",数值:o.判断错误,说明:"与标准答案不一致的条数"},{项目:"",数值:"",说明:""},{项目:"时间统计",数值:"",说明:""},{项目:"总处理时间",数值:p.总处理时间,说明:"从开始到结束的总时间"},{项目:"平均每张处理时间",数值:p.平均每张处理时间,说明:"成功处理的图片平均用时"},{项目:"开始时间",数值:p.开始时间,说明:"处理开始的时间"},{项目:"结束时间",数值:p.结束时间,说明:"处理结束的时间"}],i=$.book_new(),y=$.json_to_sheet(c);y["!cols"]=[{wch:20},{wch:15},{wch:30}],$.book_append_sheet(i,y,"处理摘要");const x=new Date().toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).replace(/[/:]/g,"-").replace(/\s/g,"_"),N=`${r}_${x}.xlsx`;return G(i,N),N},v={RESULTS:"excel-processor-results",FILE_INFO:"excel-processor-file-info",FILTER:"excel-processor-filter",TIMING:"excel-processor-timing"},_=(t,r)=>{try{localStorage.setItem(t,JSON.stringify(r))}catch(s){console.warn("保存数据失败:",s)}},W=(t,r=null)=>{try{const s=localStorage.getItem(t);return s?JSON.parse(s):r}catch(s){return console.warn("读取数据失败:",s),r}},Ne=t=>{if(!t)return"未知错误";if(t.type&&t.message){const r=[t.message];if(t.type==="api"&&t.statusCode){if(r.push(`  状态码: ${t.statusCode}`),t.url&&r.push(`  请求URL: ${t.url}`),t.responseText&&r.push(`  响应内容: ${t.responseText.substring(0,200)}${t.responseText.length>200?"...":""}`),t.response&&typeof t.response=="object"){const s=JSON.stringify(t.response,null,2);s!=="{}"&&r.push(`  错误详情: ${s}`)}}else t.type==="network"?(t.url&&r.push(`  请求URL: ${t.url}`),t.originalError&&t.originalError.message&&r.push(`  原始错误: ${t.originalError.message}`)):t.type==="parse"?(t.url&&r.push(`  请求URL: ${t.url}`),t.data&&r.push(`  解析失败的data: ${t.data.substring(0,100)}${t.data.length>100?"...":""}`),t.responseText&&r.push(`  响应文本: ${t.responseText.substring(0,200)}${t.responseText.length>200?"...":""}`)):t.type==="data"&&(t.url&&r.push(`  请求URL: ${t.url}`),t.parsedData&&r.push(`  解析后的数据: ${JSON.stringify(t.parsedData,null,2).substring(0,200)}${JSON.stringify(t.parsedData).length>200?"...":""}`),t.result&&r.push(`  原始结果: ${JSON.stringify(t.result,null,2)}`));return r.join(`
`)}return t.message||String(t)},be=({file:t,isProcessing:r,resultsLength:s,onFileSelect:n,onProcessImages:o,onReupload:a,onStop:p,onContinue:c,fileInputRef:i})=>{const[y,x]=h.useState(!1),N=k=>{k.preventDefault(),x(!0)},m=()=>{x(!1)},b=k=>{k.preventDefault(),x(!1);const g=k.dataTransfer.files[0];g&&n(g)},f=k=>{var u;const g=(u=k.target.files)==null?void 0:u[0];g&&n(g)},C=s>0;return e.jsxs("div",{className:"upload-section",children:[e.jsx("input",{ref:i,type:"file",className:"file-input",accept:".xlsx,.xls",onChange:f}),t?e.jsxs("div",{className:"selected-file",children:[e.jsxs("div",{className:"file-info",children:[e.jsx("span",{className:"file-icon",children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"}),e.jsx("polyline",{points:"14 2 14 8 20 8"})]})}),e.jsx("span",{className:"file-name",children:t.name})]}),e.jsxs("div",{className:"button-group",children:[!r&&s===0&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"btn btn-primary",onClick:()=>o(!1),children:[e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polygon",{points:"5 3 19 12 5 21 5 3"})}),"开始处理"]}),e.jsxs("button",{className:"btn btn-secondary",onClick:a,children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M21 15V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V15",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M17 8L12 3L7 8",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M12 3V15",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),"重新上传"]})]}),r&&e.jsx("button",{className:"btn btn-danger",onClick:p,children:"⏸ 暂停处理"}),!r&&C&&e.jsx("button",{className:"btn btn-success",onClick:c,children:"▶ 继续处理"})]})]}):e.jsxs("div",{className:`upload-area ${y?"dragging":""}`,onDragOver:N,onDragLeave:m,onDrop:b,onClick:()=>{var k;return(k=i.current)==null?void 0:k.click()},children:[e.jsx("div",{className:"upload-icon",children:e.jsx("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"})})}),e.jsx("div",{className:"upload-text",children:"点击或拖拽Excel文件到此处"}),e.jsx("div",{className:"upload-hint",children:"支持 .xlsx 和 .xls 格式"})]})]})},Z=h.memo(({result:t,index:r,onImageClick:s})=>e.jsxs("div",{className:`result-item ${t.status}`,children:[e.jsxs("div",{className:"result-header",children:[e.jsxs("div",{className:"result-info",children:[e.jsxs("div",{className:"result-index",children:[r+1," - 第",t.rowIndex,"行 - ",t.columnName]}),e.jsx("div",{className:"result-url",onClick:()=>s(t.url),children:t.url})]}),e.jsxs("div",{className:`result-status ${t.status}`,children:[t.status==="pending"&&"等待中",t.status==="processing"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner"}),"处理中"]}),t.status==="success"&&"成功",t.status==="error"&&"失败"]})]}),t.status==="success"&&t.result&&e.jsxs("div",{className:"result-content",children:[e.jsx("div",{children:typeof t.result=="object"&&t.result.lijie?t.result.lijie:typeof t.result=="string"?t.result:JSON.stringify(t.result,null,2)}),t.correctAnswer!==void 0&&e.jsxs("div",{style:{marginTop:"8px",fontSize:"13px",color:t.isCorrect?"#52c41a":"#ff4d4f",fontWeight:"bold"},children:[t.isCorrect?"判断正确":"判断错误","(标准答案: ",t.correctAnswer===1?"合格":"不合格",")"]})]}),t.status==="error"&&t.error&&e.jsxs("div",{className:"result-content result-error",children:["错误: ",t.error]})]}));Z.displayName="ResultItem";const Ce=({results:t,filter:r,setFilter:s,currentPage:n,pageSize:o,onPageChange:a,onReupload:p,onRestart:c,onExportResults:i,onExportSummary:y,isProcessing:x,progress:N,onImageClick:m})=>{const b={total:t.length,success:t.filter(d=>d.status==="success").length,error:t.filter(d=>d.status==="error").length,processing:t.filter(d=>d.status==="processing").length,pending:t.filter(d=>d.status==="pending").length},f={totalWithAnswer:t.filter(d=>d.correctAnswer!==void 0&&d.status==="success").length,correct:t.filter(d=>d.isCorrect===!0).length,incorrect:t.filter(d=>d.isCorrect===!1).length},C=f.totalWithAnswer>0?(f.correct/f.totalWithAnswer*100).toFixed(2):"0.00",k=t.filter(d=>r==="all"?!0:r==="error"?d.status==="error":r==="incorrect"?d.isCorrect===!1:!1),g=Math.ceil(k.length/o),u=(n-1)*o,L=u+o,R=k.slice(u,L);return e.jsxs("div",{className:"results-section",children:[e.jsxs("div",{className:"results-header",children:[e.jsx("div",{className:"results-header-left",children:e.jsx("h2",{className:"results-title",children:"处理结果"})}),e.jsx("div",{className:"results-header-right",children:e.jsxs("div",{className:"action-buttons",children:[e.jsxs("button",{className:"btn btn-secondary btn-action",onClick:p,disabled:x,title:"重新上传文件",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M21 15V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V15",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M17 8L12 3L7 8",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M12 3V15",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),e.jsx("span",{className:"btn-text",children:"重新上传"})]}),e.jsxs("button",{className:"btn btn-secondary btn-action",onClick:c,disabled:x,title:"重新开始处理",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M1 4V10H7",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M23 20V14H17",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M20.49 9C19.9828 7.56678 19.1209 6.28536 17.9845 5.27542C16.8482 4.26548 15.4745 3.55976 13.9917 3.22426C12.5089 2.88875 10.9652 2.93434 9.50481 3.35677C8.04437 3.77921 6.71475 4.56471 5.64 5.64L1 10M23 14L18.36 18.36C17.2853 19.4353 15.9556 20.2208 14.4952 20.6432C13.0348 21.0657 11.4911 21.1112 10.0083 20.7757C8.52547 20.4402 7.1518 19.7345 6.01547 18.7246C4.87913 17.7146 4.01717 16.4332 3.51 15",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),e.jsx("span",{className:"btn-text",children:"重新开始"})]}),t.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"btn btn-secondary btn-action",onClick:i,disabled:x,title:"导出详细结果",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M21 15V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V15",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M7 10L12 15L17 10",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M12 15V3",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),e.jsx("span",{className:"btn-text",children:"导出结果"})]}),e.jsxs("button",{className:"btn btn-secondary btn-action",onClick:y,disabled:x,title:"导出统计摘要",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M9 9H15",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),e.jsx("path",{d:"M9 12H15",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),e.jsx("path",{d:"M9 15H12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),e.jsx("span",{className:"btn-text",children:"导出摘要"})]})]})]})})]}),f.totalWithAnswer>0&&e.jsx("div",{className:"accuracy-section",children:e.jsxs("div",{className:"accuracy-card",children:[e.jsx("div",{className:"accuracy-title",children:"准确率统计"}),e.jsxs("div",{className:"accuracy-value",children:[C,"%"]}),e.jsxs("div",{className:"accuracy-buttons",children:[e.jsxs("button",{className:`accuracy-btn ${r==="all"?"active":""}`,onClick:()=>s("all"),children:["全部数据: ",b.total]}),e.jsxs("button",{className:`accuracy-btn ${r==="error"?"active":""}`,onClick:()=>s("error"),children:["处理失败: ",b.error]}),e.jsxs("button",{className:`accuracy-btn ${r==="incorrect"?"active":""}`,onClick:()=>s("incorrect"),children:["判断错误: ",f.incorrect]})]})]})}),x&&e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:"progress-fill",style:{width:`${N}%`}})}),r!=="all"&&e.jsxs("div",{className:"filter-info",children:[e.jsx("span",{children:"当前筛选: "}),e.jsxs("strong",{children:[r==="error"&&"处理失败",r==="incorrect"&&"判断错误"]}),e.jsxs("span",{children:[" (",k.length," 条)"]}),e.jsx("button",{className:"btn-clear-filter",onClick:()=>s("all"),children:"清除筛选"})]}),e.jsx("div",{className:"results-list",children:R.length>0?R.map(d=>e.jsx(Z,{result:d,index:t.indexOf(d),onImageClick:m},t.indexOf(d))):e.jsxs("div",{className:"empty-filter",children:[e.jsx("div",{className:"empty-filter-text",children:"没有符合筛选条件的结果"}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>s("all"),children:"查看全部"})]})}),g>1&&e.jsxs("div",{className:"pagination",children:[e.jsx("button",{className:"btn btn-secondary pagination-btn",onClick:()=>a(1),disabled:n===1,children:"首页"}),e.jsx("button",{className:"btn btn-secondary pagination-btn",onClick:()=>a(n-1),disabled:n===1,children:"上一页"}),Array.from({length:g},(d,M)=>M+1).map(d=>e.jsx("button",{className:`btn pagination-btn ${n===d?"active":""}`,onClick:()=>a(d),children:d},d)),e.jsx("button",{className:"btn btn-secondary pagination-btn",onClick:()=>a(n+1),disabled:n===g,children:"下一页"}),e.jsx("button",{className:"btn btn-secondary pagination-btn",onClick:()=>a(g),disabled:n===g,children:"末页"}),e.jsxs("div",{className:"pagination-info",children:["第 ",n," / ",g," 页"]})]})]})},Le=({message:t,type:r})=>e.jsx("div",{className:`notification ${r}`,children:e.jsxs("div",{className:"notification-content",children:[e.jsx("span",{className:"notification-icon",children:r==="success"?e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",children:e.jsx("path",{d:"M8 1L15 8L8 15L1 8L8 1Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}):e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",children:[e.jsx("path",{d:"M14 2L2 14",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),e.jsx("path",{d:"M2 2L14 14",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]})}),e.jsx("span",{className:"notification-message",children:t})]})}),Se=({imageUrl:t,onClose:r})=>e.jsx("div",{className:"image-preview-modal",onClick:r,children:e.jsxs("div",{className:"image-preview-content",onClick:s=>s.stopPropagation(),children:[e.jsx("button",{className:"image-preview-close",onClick:r,children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M18 6L6 18",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M6 6L18 18",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})}),e.jsx("img",{src:t,alt:"预览图片",className:"image-preview-img",onError:s=>{const n=s.currentTarget,o=n.nextElementSibling;n.style.display="none",o&&(o.style.display="block")}}),e.jsxs("div",{className:"image-preview-error",style:{display:"none"},children:[e.jsxs("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"#f56c6c",strokeWidth:"2"}),e.jsx("path",{d:"M12 8V12",stroke:"#f56c6c",strokeWidth:"2",strokeLinecap:"round"}),e.jsx("circle",{cx:"12",cy:"16",r:"1",fill:"#f56c6c"})]}),e.jsx("p",{children:"图片加载失败"}),e.jsx("p",{className:"image-preview-url",children:t})]})]})}),Ee=()=>e.jsx("div",{className:"stopping-overlay",children:e.jsxs("div",{className:"stopping-content",children:[e.jsx("div",{className:"stopping-spinner"}),e.jsx("div",{className:"stopping-text",children:"正在暂停处理..."}),e.jsx("div",{className:"stopping-hint",children:"请稍等片刻"})]})});function Te(){const[t,r]=h.useState(null),[s,n]=h.useState(()=>W(v.RESULTS,[])),[o,a]=h.useState(()=>W("excel-processor-is-processing",!1)),[p,c]=h.useState(!1),[i,y]=h.useState(()=>W(v.FILTER,"all")),[x,N]=h.useState(null),[m,b]=h.useState(1),[f]=h.useState(10),C=h.useRef(null),k=h.useRef(!1),g=h.useRef(null),u=h.useRef(W(v.RESULTS,[])),[L,R]=h.useState(()=>W(v.TIMING,{startTime:null,endTime:null,totalTime:0})),d=h.useRef(null),[M,F]=h.useState(null),I=h.useCallback((l,S="success")=>{F({message:l,type:S}),setTimeout(()=>{F(null)},2e3)},[]);h.useEffect(()=>{const l=W(v.FILE_INFO);if(l){const S=new File([""],l.name,{type:l.type});r(S)}if(s.length>0&&s.some(j=>j.status==="processing")){const j=s.map(E=>E.status==="processing"?{...E,status:"pending"}:E);n(j),u.current=j,_(v.RESULTS,j),a(!1),_("excel-processor-is-processing",!1)}},[]),h.useEffect(()=>{const l=S=>{if(o||s.some(j=>j.status==="pending"||j.status==="processing"))return S.preventDefault(),""};return window.addEventListener("beforeunload",l),()=>{window.removeEventListener("beforeunload",l)}},[o,s]),h.useEffect(()=>{s.length>0&&(_(v.RESULTS,s),u.current=s)},[s]),h.useEffect(()=>{_(v.FILTER,i),b(1)},[i]),h.useEffect(()=>{_(v.TIMING,L)},[L]),h.useEffect(()=>{_("excel-processor-is-processing",o)},[o]);const q=l=>{l&&l.name.match(/\.(xlsx|xls)$/i)?(r(l),n([]),u.current=[],y("all"),_(v.FILE_INFO,{name:l.name,type:l.type,size:l.size}),localStorage.removeItem(v.RESULTS),localStorage.removeItem(v.TIMING),R({startTime:null,endTime:null,totalTime:0})):alert("请选择有效的Excel文件（.xlsx 或 .xls）")},J=h.useCallback(()=>{var l;o||(localStorage.removeItem(v.RESULTS),localStorage.removeItem(v.FILE_INFO),localStorage.removeItem(v.FILTER),localStorage.removeItem(v.TIMING),n([]),u.current=[],y("all"),r(null),R({startTime:null,endTime:null,totalTime:0}),C.current&&(C.current.value=""),(l=C.current)==null||l.click())},[o]),Y=h.useCallback(()=>{o||window.confirm("确定要重新开始吗？当前所有处理结果将被清空。")&&(n([]),u.current=[],y("all"),localStorage.removeItem(v.RESULTS),localStorage.removeItem(v.TIMING),_(v.FILTER,"all"),R({startTime:null,endTime:null,totalTime:0}))},[o]),X=h.useCallback(()=>{if(s.length===0){I("没有可导出的数据","error");return}try{const l=ve(s,"图片处理结果");I(`导出成功！文件名：${l}`,"success")}catch(l){I(`导出失败：${l.message}`,"error")}},[s,I]),ee=h.useCallback(()=>{if(s.length===0){I("没有可导出的数据","error");return}try{const l=ye(s,"处理统计摘要",L);I(`导出成功！文件名：${l}`,"success")}catch(l){I(`导出失败：${l.message}`,"error")}},[s,L,I]),U=h.useCallback(async(l=!1)=>{var S;if(t){a(!0),k.current=!1,g.current=new AbortController,l?d.current===null&&L.startTime&&(d.current=L.startTime):(d.current=Date.now(),R(j=>({...j,startTime:d.current,endTime:null})));try{let j,E=0;if(l&&u.current.length>0){if(j=u.current.map(w=>({url:w.url,rowIndex:w.rowIndex,columnName:w.columnName,correctAnswer:w.correctAnswer})),E=u.current.findIndex(w=>w.status==="pending"),E===-1){alert("没有待处理的项目"),a(!1);return}}else{if(j=await ge(t),j.length===0){alert('未在Excel中找到包含"截图链接"字样的列或该列没有数据'),a(!1);return}const w=j.map(A=>({...A,status:"pending"}));u.current=w,n([...w])}for(let w=E;w<j.length;w++){if(k.current){console.log("用户终止处理"),u.current[w]={...u.current[w],status:"pending"},n([...u.current]);break}const A=j[w];u.current[w]={...u.current[w],status:"processing"},n([...u.current]);try{const T=await ke(A.url,(S=g.current)==null?void 0:S.signal);if(k.current){u.current[w]={...u.current[w],status:"pending"},n([...u.current]);break}let z;if(A.correctAnswer!==void 0){const B=typeof T=="object"&&T.lijie?T.lijie:typeof T=="string"?T:JSON.stringify(T),ne=B.includes("合格")&&!B.includes("不合格"),oe=B.includes("不合格"),ae=ne&&!oe,ie=A.correctAnswer===1;z=ae===ie}u.current[w]={...u.current[w],status:"success",result:T,isCorrect:z},n([...u.current])}catch(T){u.current[w]={...u.current[w],status:"error",error:Ne(T)},n([...u.current])}}}catch(j){j.name!=="AbortError"&&alert(`处理失败: ${j.message}`)}finally{if(g.current=null,a(!1),c(!1),d.current!==null){const j=Date.now();R(E=>({...E,endTime:j,totalTime:j-d.current}))}}}},[t]),te=h.useCallback(()=>{c(!0),k.current=!0,g.current&&(g.current.abort(),console.log("已中断API调用"));const l=setInterval(()=>{(!k.current||!o)&&(c(!1),clearInterval(l))},100)},[o]),se=h.useCallback(()=>{U(!0)},[U]),re=s.length>0?(s.filter(l=>l.status==="success").length+s.filter(l=>l.status==="error").length)/s.length*100:0;return e.jsxs("div",{className:"app-container",children:[M&&e.jsx(Le,{message:M.message,type:M.type,onClose:()=>F(null)}),e.jsxs("div",{className:"app-header",children:[e.jsx("img",{src:"img-judge.svg"}),e.jsx("h1",{className:"app-title",children:"图片审核工具"})]}),e.jsxs("div",{className:"main-content",children:[e.jsx(be,{file:t,isProcessing:o,resultsLength:s.length,onFileSelect:q,onProcessImages:U,onReupload:J,onStop:te,onContinue:se,fileInputRef:C}),s.length>0&&e.jsx(Ce,{results:s,filter:i,setFilter:y,currentPage:m,pageSize:f,onPageChange:b,onReupload:J,onRestart:Y,onExportResults:X,onExportSummary:ee,isProcessing:o,progress:re,onImageClick:N}),s.length===0&&t&&!o&&e.jsx("div",{className:"empty-state",children:e.jsx("div",{className:"empty-text",children:'点击"开始处理"按钮来处理Excel中的图片链接'})}),x&&e.jsx(Se,{imageUrl:x,onClose:()=>N(null)}),p&&e.jsx(Ee,{})]})]})}V.createRoot(document.getElementById("root")).render(e.jsx(le.StrictMode,{children:e.jsx(Te,{})}));
