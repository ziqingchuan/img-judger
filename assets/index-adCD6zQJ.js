import{r as h,a as ie,R as le}from"./vendor-wGySg1uH.js";import{r as de,u as _,w as G}from"./xlsx-CKN5doRT.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const p of a.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&n(p)}).observe(document,{childList:!0,subtree:!0});function t(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(o){if(o.ep)return;o.ep=!0;const a=t(o);fetch(o.href,a)}})();var Q={exports:{}},D={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ue=h,he=Symbol.for("react.element"),pe=Symbol.for("react.fragment"),me=Object.prototype.hasOwnProperty,xe=ue.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ge={key:!0,ref:!0,__self:!0,__source:!0};function K(s,r,t){var n,o={},a=null,p=null;t!==void 0&&(a=""+t),r.key!==void 0&&(a=""+r.key),r.ref!==void 0&&(p=r.ref);for(n in r)me.call(r,n)&&!ge.hasOwnProperty(n)&&(o[n]=r[n]);if(s&&s.defaultProps)for(n in r=s.defaultProps,r)o[n]===void 0&&(o[n]=r[n]);return{$$typeof:he,type:s,key:a,ref:p,props:o,_owner:xe.current}}D.Fragment=pe;D.jsx=K;D.jsxs=K;Q.exports=D;var e=Q.exports,V={},H=ie;V.createRoot=H.createRoot,V.hydrateRoot=H.hydrateRoot;const fe=async s=>new Promise((r,t)=>{const n=new FileReader;n.onload=o=>{var a;try{const p=(a=o.target)==null?void 0:a.result,i=de(p,{type:"binary"}),c=i.Sheets[i.SheetNames[0]],v=_.sheet_to_json(c,{header:1}),g=[];if(v.length===0){r([]);return}const b=v[0],m=[];if(b.forEach((x,C)=>{x&&x.toString().includes("截图链接")&&m.push(C)}),m.length===0){console.warn('未找到包含"截图链接"字样的列'),r([]);return}const N=b.findIndex(x=>x&&x.toString().includes("正确答案"));for(let x=1;x<v.length;x++){const C=v[x];m.forEach(k=>{const f=C[k];if(f&&typeof f=="string"&&f.trim()){const u={url:f.trim(),rowIndex:x+1,columnName:b[k]};if(N!==-1&&C[N]!==void 0){const L=C[N];u.correctAnswer=Number(L)}g.push(u)}})}r(g)}catch(p){t(p)}},n.onerror=()=>{t(new Error("文件读取失败"))},n.readAsBinaryString(s)}),P="https://api.coze.cn/v1/workflow/run",je="pat_v6RwanL44Q047UNcfQVnvdBiS6VPfzFJQ4EeXy0gOLYNE3Ar1CsSGoka2tyksCyP",we="7577583987406471187",$=(s,r,t)=>{const n=new Error(s);return n.type=r,Object.assign(n,t),n},ke=async(s,r)=>{var t;try{const n=JSON.stringify({workflow_id:we,parameters:{rawUrl:s}});let o;try{o=await fetch(P,{method:"POST",headers:{Authorization:`Bearer ${je}`,"Content-Type":"application/json"},body:n,signal:r})}catch(i){throw i.name==="AbortError"?i:$(`网络请求失败: ${i.message}`,"network",{url:P,originalError:i})}if(!o.ok){let i={},c="";try{c=await o.text();try{i=JSON.parse(c)}catch{i={message:c}}}catch{i={}}throw i.code===4013?$(`请求频率超过限制: ${i.msg||"请降低请求频率"}`,"api",{statusCode:o.status,url:s,response:i,responseText:c,debugUrl:i.debug_url,logId:(t=i.detail)==null?void 0:t.logid}):$(`工作流API调用失败 (HTTP ${o.status})${i.msg?": "+i.msg:""}`,"api",{statusCode:o.status,url:s,response:i,responseText:c})}let a;try{a=await o.json(),console.log("Coze工作流调用成功，结果：",a)}catch(i){const c=await o.text();throw $(`响应JSON解析失败: ${i.message}`,"parse",{responseText:c,url:s,originalError:i})}let p;if(typeof a.data=="string")try{p=JSON.parse(a.data),console.log("data 字段是字符串，尝试解析",p)}catch(i){throw $(`工作流返回的data字段JSON解析失败: ${i.message}`,"parse",{data:a.data,url:s,originalError:i})}else if(a.data)p=a.data,console.log("data 字段不是字符串，直接使用",p);else throw $("工作流返回的数据中缺少 data 字段","data",{result:a,url:s});if(p.res)return p.res;throw $("解析后的数据中未找到 res 字段","data",{parsedData:p,url:s})}catch(n){throw console.error("Coze工作流调用失败:",n),n&&n.type?n:$(`未知错误: ${(n==null?void 0:n.message)||String(n)}`,"network",{url:s,originalError:n})}},ve=(s,r="处理结果")=>{const t=s.map((c,v)=>{let g="";switch(c.status){case"success":g="成功";break;case"error":g="失败";break;case"pending":g="待处理";break;case"processing":g="处理中";break;default:g="未知"}let b="";c.status==="success"&&c.result&&(typeof c.result=="object"&&c.result.lijie?b=c.result.lijie:typeof c.result=="string"?b=c.result:b=JSON.stringify(c.result));let m="";c.correctAnswer!==void 0&&(m=c.correctAnswer===1?"合格":"不合格");let N="";c.correctAnswer!==void 0&&c.isCorrect!==void 0&&(N=c.isCorrect?"正确":"错误");const x={序号:v+1,行号:c.rowIndex,列名:c.columnName,图片链接:c.url,处理状态:g,审核结果:b,标准答案:m,判断结果:N};return c.status==="error"&&c.error&&(x.错误信息=c.error),x}),n=_.book_new(),o=_.json_to_sheet(t),a=[{wch:6},{wch:8},{wch:15},{wch:50},{wch:10},{wch:30},{wch:10},{wch:10},{wch:30}];o["!cols"]=a,_.book_append_sheet(n,o,"处理结果");const p=new Date().toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).replace(/[/:]/g,"-").replace(/\s/g,"_"),i=`${r}_${p}.xlsx`;return G(n,i),i},Ne=(s,r="处理摘要",t)=>{const n={总计:s.length,成功:s.filter(m=>m.status==="success").length,失败:s.filter(m=>m.status==="error").length,待处理:s.filter(m=>m.status==="pending").length,处理中:s.filter(m=>m.status==="processing").length},o={有标准答案总数:s.filter(m=>m.correctAnswer!==void 0&&m.status==="success").length,判断正确:s.filter(m=>m.isCorrect===!0).length,判断错误:s.filter(m=>m.isCorrect===!1).length},a=o.有标准答案总数>0?(o.判断正确/o.有标准答案总数*100).toFixed(2)+"%":"0.00%",p={总处理时间:t!=null&&t.totalTime?`${(t.totalTime/1e3).toFixed(2)}秒`:"未记录",平均每张处理时间:t!=null&&t.totalTime&&n.成功>0?`${(t.totalTime/1e3/n.成功).toFixed(2)}秒`:"未记录",开始时间:t!=null&&t.startTime?new Date(t.startTime).toLocaleString("zh-CN"):"未记录",结束时间:t!=null&&t.endTime?new Date(t.endTime).toLocaleString("zh-CN"):"未记录"},i=[{项目:"处理统计",数值:"",说明:""},{项目:"总计",数值:n.总计,说明:"所有数据条数"},{项目:"成功",数值:n.成功,说明:"处理成功的条数"},{项目:"失败",数值:n.失败,说明:"处理失败的条数"},{项目:"待处理",数值:n.待处理,说明:"尚未处理的条数"},{项目:"处理中",数值:n.处理中,说明:"正在处理的条数"},{项目:"",数值:"",说明:""},{项目:"准确率统计",数值:"",说明:""},{项目:"准确率",数值:a,说明:"判断正确的比例"},{项目:"有标准答案总数",数值:o.有标准答案总数,说明:"包含标准答案的数据条数"},{项目:"判断正确",数值:o.判断正确,说明:"与标准答案一致的条数"},{项目:"判断错误",数值:o.判断错误,说明:"与标准答案不一致的条数"},{项目:"",数值:"",说明:""},{项目:"时间统计",数值:"",说明:""},{项目:"总处理时间",数值:p.总处理时间,说明:"从开始到结束的总时间"},{项目:"平均每张处理时间",数值:p.平均每张处理时间,说明:"成功处理的图片平均用时"},{项目:"开始时间",数值:p.开始时间,说明:"处理开始的时间"},{项目:"结束时间",数值:p.结束时间,说明:"处理结束的时间"}],c=_.book_new(),v=_.json_to_sheet(i);v["!cols"]=[{wch:20},{wch:15},{wch:30}],_.book_append_sheet(c,v,"处理摘要");const g=new Date().toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).replace(/[/:]/g,"-").replace(/\s/g,"_"),b=`${r}_${g}.xlsx`;return G(c,b),b},y={RESULTS:"excel-processor-results",FILE_INFO:"excel-processor-file-info",FILTER:"excel-processor-filter",TIMING:"excel-processor-timing"},O=(s,r)=>{try{localStorage.setItem(s,JSON.stringify(r))}catch(t){console.warn("保存数据失败:",t)}},W=(s,r=null)=>{try{const t=localStorage.getItem(s);return t?JSON.parse(t):r}catch(t){return console.warn("读取数据失败:",t),r}},ye=s=>{if(!s)return"未知错误";if(s.type&&s.message){const r=[s.message];if(s.type==="api"&&s.statusCode){if(r.push(`  状态码: ${s.statusCode}`),s.url&&r.push(`  请求URL: ${s.url}`),s.responseText&&r.push(`  响应内容: ${s.responseText.substring(0,200)}${s.responseText.length>200?"...":""}`),s.response&&typeof s.response=="object"){const t=JSON.stringify(s.response,null,2);t!=="{}"&&r.push(`  错误详情: ${t}`)}}else s.type==="network"?(s.url&&r.push(`  请求URL: ${s.url}`),s.originalError&&s.originalError.message&&r.push(`  原始错误: ${s.originalError.message}`)):s.type==="parse"?(s.url&&r.push(`  请求URL: ${s.url}`),s.data&&r.push(`  解析失败的data: ${s.data.substring(0,100)}${s.data.length>100?"...":""}`),s.responseText&&r.push(`  响应文本: ${s.responseText.substring(0,200)}${s.responseText.length>200?"...":""}`)):s.type==="data"&&(s.url&&r.push(`  请求URL: ${s.url}`),s.parsedData&&r.push(`  解析后的数据: ${JSON.stringify(s.parsedData,null,2).substring(0,200)}${JSON.stringify(s.parsedData).length>200?"...":""}`),s.result&&r.push(`  原始结果: ${JSON.stringify(s.result,null,2)}`));return r.join(`
`)}return s.message||String(s)},be=({file:s,isProcessing:r,resultsLength:t,onFileSelect:n,onProcessImages:o,onReupload:a,onStop:p,onContinue:i})=>{const[c,v]=h.useState(!1),g=h.useRef(null),b=k=>{k.preventDefault(),v(!0)},m=()=>{v(!1)},N=k=>{k.preventDefault(),v(!1);const f=k.dataTransfer.files[0];f&&n(f)},x=k=>{var u;const f=(u=k.target.files)==null?void 0:u[0];f&&n(f)},C=t>0;return e.jsxs("div",{className:"upload-section",children:[e.jsx("input",{ref:g,type:"file",className:"file-input",accept:".xlsx,.xls",onChange:x}),s?e.jsxs("div",{className:"selected-file",children:[e.jsxs("div",{className:"file-info",children:[e.jsx("span",{className:"file-icon",children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"}),e.jsx("polyline",{points:"14 2 14 8 20 8"})]})}),e.jsx("span",{className:"file-name",children:s.name})]}),e.jsxs("div",{className:"button-group",children:[!r&&t===0&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"btn btn-primary",onClick:()=>o(!1),children:[e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polygon",{points:"5 3 19 12 5 21 5 3"})}),"开始处理"]}),e.jsxs("button",{className:"btn btn-secondary",onClick:a,children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M21 15V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V15",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M17 8L12 3L7 8",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M12 3V15",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),"重新上传"]})]}),r&&e.jsx("button",{className:"btn btn-danger",onClick:p,children:"⏸ 暂停处理"}),!r&&C&&e.jsx("button",{className:"btn btn-success",onClick:i,children:"▶ 继续处理"})]})]}):e.jsxs("div",{className:`upload-area ${c?"dragging":""}`,onDragOver:b,onDragLeave:m,onDrop:N,onClick:()=>{var k;return(k=g.current)==null?void 0:k.click()},children:[e.jsx("div",{className:"upload-icon",children:e.jsx("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"})})}),e.jsx("div",{className:"upload-text",children:"点击或拖拽Excel文件到此处"}),e.jsx("div",{className:"upload-hint",children:"支持 .xlsx 和 .xls 格式"})]})]})},Z=h.memo(({result:s,index:r,onImageClick:t})=>e.jsxs("div",{className:`result-item ${s.status}`,children:[e.jsxs("div",{className:"result-header",children:[e.jsxs("div",{className:"result-info",children:[e.jsxs("div",{className:"result-index",children:[r+1," - 第",s.rowIndex,"行 - ",s.columnName]}),e.jsx("div",{className:"result-url",onClick:()=>t(s.url),children:s.url})]}),e.jsxs("div",{className:`result-status ${s.status}`,children:[s.status==="pending"&&"等待中",s.status==="processing"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner"}),"处理中"]}),s.status==="success"&&"成功",s.status==="error"&&"失败"]})]}),s.status==="success"&&s.result&&e.jsxs("div",{className:"result-content",children:[e.jsx("div",{children:typeof s.result=="object"&&s.result.lijie?s.result.lijie:typeof s.result=="string"?s.result:JSON.stringify(s.result,null,2)}),s.correctAnswer!==void 0&&e.jsxs("div",{style:{marginTop:"8px",fontSize:"13px",color:s.isCorrect?"#52c41a":"#ff4d4f",fontWeight:"bold"},children:[s.isCorrect?"判断正确":"判断错误","(标准答案: ",s.correctAnswer===1?"合格":"不合格",")"]})]}),s.status==="error"&&s.error&&e.jsxs("div",{className:"result-content result-error",children:["错误: ",s.error]})]}));Z.displayName="ResultItem";const Ce=({results:s,filter:r,setFilter:t,currentPage:n,pageSize:o,onPageChange:a,onReupload:p,onRestart:i,onExportResults:c,onExportSummary:v,isProcessing:g,progress:b,onImageClick:m})=>{const N={total:s.length,success:s.filter(l=>l.status==="success").length,error:s.filter(l=>l.status==="error").length,processing:s.filter(l=>l.status==="processing").length,pending:s.filter(l=>l.status==="pending").length},x={totalWithAnswer:s.filter(l=>l.correctAnswer!==void 0&&l.status==="success").length,correct:s.filter(l=>l.isCorrect===!0).length,incorrect:s.filter(l=>l.isCorrect===!1).length},C=x.totalWithAnswer>0?(x.correct/x.totalWithAnswer*100).toFixed(2):"0.00",k=s.filter(l=>r==="all"?!0:r==="correct"?l.isCorrect===!0:r==="incorrect"?l.isCorrect===!1:l.status===r),f=Math.ceil(k.length/o),u=(n-1)*o,L=u+o,R=k.slice(u,L);return e.jsxs("div",{className:"results-section",children:[e.jsxs("div",{className:"results-header",children:[e.jsx("div",{className:"results-header-left",children:e.jsx("h2",{className:"results-title",children:"处理结果"})}),e.jsx("div",{className:"results-header-right",children:e.jsxs("div",{className:"action-buttons",children:[e.jsxs("button",{className:"btn btn-secondary btn-action",onClick:p,disabled:g,title:"重新上传文件",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M21 15V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V15",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M17 8L12 3L7 8",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M12 3V15",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),e.jsx("span",{className:"btn-text",children:"重新上传"})]}),e.jsxs("button",{className:"btn btn-secondary btn-action",onClick:i,disabled:g,title:"重新开始处理",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M1 4V10H7",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M23 20V14H17",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M20.49 9C19.9828 7.56678 19.1209 6.28536 17.9845 5.27542C16.8482 4.26548 15.4745 3.55976 13.9917 3.22426C12.5089 2.88875 10.9652 2.93434 9.50481 3.35677C8.04437 3.77921 6.71475 4.56471 5.64 5.64L1 10M23 14L18.36 18.36C17.2853 19.4353 15.9556 20.2208 14.4952 20.6432C13.0348 21.0657 11.4911 21.1112 10.0083 20.7757C8.52547 20.4402 7.1518 19.7345 6.01547 18.7246C4.87913 17.7146 4.01717 16.4332 3.51 15",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),e.jsx("span",{className:"btn-text",children:"重新开始"})]}),s.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"btn btn-secondary btn-action",onClick:c,disabled:g,title:"导出详细结果",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M21 15V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V15",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M7 10L12 15L17 10",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M12 15V3",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),e.jsx("span",{className:"btn-text",children:"导出结果"})]}),e.jsxs("button",{className:"btn btn-secondary btn-action",onClick:v,disabled:g,title:"导出统计摘要",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M9 9H15",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),e.jsx("path",{d:"M9 12H15",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),e.jsx("path",{d:"M9 15H12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),e.jsx("span",{className:"btn-text",children:"导出摘要"})]})]})]})})]}),e.jsx("div",{className:"results-stats-row",children:e.jsxs("div",{className:"results-stats",children:[e.jsxs("div",{className:`stat-item clickable ${r==="all"?"active":""}`,onClick:()=>t("all"),children:[e.jsx("span",{className:"stat-label",children:"总计:"}),e.jsx("span",{className:"stat-value",children:N.total})]}),e.jsxs("div",{className:`stat-item clickable ${r==="success"?"active":""}`,onClick:()=>t("success"),children:[e.jsx("span",{className:"stat-label",children:"成功:"}),e.jsx("span",{className:"stat-value success",children:N.success})]}),e.jsxs("div",{className:`stat-item clickable ${r==="error"?"active":""}`,onClick:()=>t("error"),children:[e.jsx("span",{className:"stat-label",children:"失败:"}),e.jsx("span",{className:"stat-value error",children:N.error})]}),N.processing>0&&e.jsxs("div",{className:`stat-item clickable ${r==="processing"?"active":""}`,onClick:()=>t("processing"),children:[e.jsx("span",{className:"stat-label",children:"处理中:"}),e.jsx("span",{className:"stat-value processing",children:N.processing})]}),N.pending>0&&e.jsxs("div",{className:`stat-item clickable ${r==="pending"?"active":""}`,onClick:()=>t("pending"),children:[e.jsx("span",{className:"stat-label",children:"待处理:"}),e.jsx("span",{className:"stat-value pending",children:N.pending})]})]})}),x.totalWithAnswer>0&&e.jsx("div",{className:"accuracy-section",children:e.jsxs("div",{className:"accuracy-card",children:[e.jsx("div",{className:"accuracy-title",children:"准确率统计"}),e.jsxs("div",{className:"accuracy-value",children:[C,"%"]}),e.jsxs("div",{className:"accuracy-details",children:[e.jsxs("span",{className:`accuracy-detail-item correct clickable ${r==="correct"?"active":""}`,onClick:()=>t("correct"),children:["正确: ",x.correct]}),e.jsxs("span",{className:`accuracy-detail-item incorrect clickable ${r==="incorrect"?"active":""}`,onClick:()=>t("incorrect"),children:["错误: ",x.incorrect]}),e.jsxs("span",{className:`accuracy-detail-item total clickable ${r==="all"?"active":""}`,onClick:()=>t("all"),children:["总数: ",x.totalWithAnswer]})]})]})}),g&&e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:"progress-fill",style:{width:`${b}%`}})}),r!=="all"&&e.jsxs("div",{className:"filter-info",children:[e.jsx("span",{children:"当前筛选: "}),e.jsxs("strong",{children:[r==="success"&&"成功",r==="error"&&"失败",r==="pending"&&"待处理",r==="processing"&&"处理中",r==="correct"&&"判断正确",r==="incorrect"&&"判断错误"]}),e.jsxs("span",{children:[" (",k.length," 条)"]}),e.jsx("button",{className:"btn-clear-filter",onClick:()=>t("all"),children:"清除筛选"})]}),e.jsx("div",{className:"results-list",children:R.length>0?R.map(l=>e.jsx(Z,{result:l,index:s.indexOf(l),onImageClick:m},s.indexOf(l))):e.jsxs("div",{className:"empty-filter",children:[e.jsx("div",{className:"empty-filter-text",children:"没有符合筛选条件的结果"}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>t("all"),children:"查看全部"})]})}),f>1&&e.jsxs("div",{className:"pagination",children:[e.jsx("button",{className:"btn btn-secondary pagination-btn",onClick:()=>a(1),disabled:n===1,children:"首页"}),e.jsx("button",{className:"btn btn-secondary pagination-btn",onClick:()=>a(n-1),disabled:n===1,children:"上一页"}),Array.from({length:f},(l,A)=>A+1).map(l=>e.jsx("button",{className:`btn pagination-btn ${n===l?"active":""}`,onClick:()=>a(l),children:l},l)),e.jsx("button",{className:"btn btn-secondary pagination-btn",onClick:()=>a(n+1),disabled:n===f,children:"下一页"}),e.jsx("button",{className:"btn btn-secondary pagination-btn",onClick:()=>a(f),disabled:n===f,children:"末页"}),e.jsxs("div",{className:"pagination-info",children:["第 ",n," / ",f," 页"]})]})]})},Le=({message:s,type:r})=>e.jsx("div",{className:`notification ${r}`,children:e.jsxs("div",{className:"notification-content",children:[e.jsx("span",{className:"notification-icon",children:r==="success"?e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",children:e.jsx("path",{d:"M8 1L15 8L8 15L1 8L8 1Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}):e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",children:[e.jsx("path",{d:"M14 2L2 14",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),e.jsx("path",{d:"M2 2L14 14",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]})}),e.jsx("span",{className:"notification-message",children:s})]})}),Se=({imageUrl:s,onClose:r})=>e.jsx("div",{className:"image-preview-modal",onClick:r,children:e.jsxs("div",{className:"image-preview-content",onClick:t=>t.stopPropagation(),children:[e.jsx("button",{className:"image-preview-close",onClick:r,children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M18 6L6 18",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M6 6L18 18",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})}),e.jsx("img",{src:s,alt:"预览图片",className:"image-preview-img",onError:t=>{const n=t.currentTarget,o=n.nextElementSibling;n.style.display="none",o&&(o.style.display="block")}}),e.jsxs("div",{className:"image-preview-error",style:{display:"none"},children:[e.jsxs("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"#f56c6c",strokeWidth:"2"}),e.jsx("path",{d:"M12 8V12",stroke:"#f56c6c",strokeWidth:"2",strokeLinecap:"round"}),e.jsx("circle",{cx:"12",cy:"16",r:"1",fill:"#f56c6c"})]}),e.jsx("p",{children:"图片加载失败"}),e.jsx("p",{className:"image-preview-url",children:s})]})]})}),Ee=()=>e.jsx("div",{className:"stopping-overlay",children:e.jsxs("div",{className:"stopping-content",children:[e.jsx("div",{className:"stopping-spinner"}),e.jsx("div",{className:"stopping-text",children:"正在暂停处理..."}),e.jsx("div",{className:"stopping-hint",children:"请稍等片刻"})]})});function Te(){const[s,r]=h.useState(null),[t,n]=h.useState(()=>W(y.RESULTS,[])),[o,a]=h.useState(()=>W("excel-processor-is-processing",!1)),[p,i]=h.useState(!1),[c,v]=h.useState(()=>W(y.FILTER,"all")),[g,b]=h.useState(null),[m,N]=h.useState(1),[x]=h.useState(10),C=h.useRef(null),k=h.useRef(!1),f=h.useRef(null),u=h.useRef(W(y.RESULTS,[])),[L,R]=h.useState(()=>W(y.TIMING,{startTime:null,endTime:null,totalTime:0})),l=h.useRef(null),[A,F]=h.useState(null),I=h.useCallback((d,S="success")=>{F({message:d,type:S}),setTimeout(()=>{F(null)},2e3)},[]);h.useEffect(()=>{const d=W(y.FILE_INFO);if(d){const S=new File([""],d.name,{type:d.type});r(S)}if(t.length>0&&t.some(j=>j.status==="processing")){const j=t.map(E=>E.status==="processing"?{...E,status:"pending"}:E);n(j),u.current=j,O(y.RESULTS,j),a(!1),O("excel-processor-is-processing",!1)}},[]),h.useEffect(()=>{const d=S=>{if(o||t.some(j=>j.status==="pending"||j.status==="processing"))return S.preventDefault(),""};return window.addEventListener("beforeunload",d),()=>{window.removeEventListener("beforeunload",d)}},[o,t]),h.useEffect(()=>{t.length>0&&(O(y.RESULTS,t),u.current=t)},[t]),h.useEffect(()=>{O(y.FILTER,c),N(1)},[c]),h.useEffect(()=>{O(y.TIMING,L)},[L]),h.useEffect(()=>{O("excel-processor-is-processing",o)},[o]);const q=d=>{d&&d.name.match(/\.(xlsx|xls)$/i)?(r(d),n([]),u.current=[],v("all"),O(y.FILE_INFO,{name:d.name,type:d.type,size:d.size}),localStorage.removeItem(y.RESULTS),localStorage.removeItem(y.TIMING),R({startTime:null,endTime:null,totalTime:0})):alert("请选择有效的Excel文件（.xlsx 或 .xls）")},J=h.useCallback(()=>{var d;o||(localStorage.removeItem(y.RESULTS),localStorage.removeItem(y.FILE_INFO),localStorage.removeItem(y.FILTER),localStorage.removeItem(y.TIMING),n([]),u.current=[],v("all"),r(null),R({startTime:null,endTime:null,totalTime:0}),(d=C.current)==null||d.click())},[o]),Y=h.useCallback(()=>{o||window.confirm("确定要重新开始吗？当前所有处理结果将被清空。")&&(n([]),u.current=[],v("all"),localStorage.removeItem(y.RESULTS),localStorage.removeItem(y.TIMING),O(y.FILTER,"all"),R({startTime:null,endTime:null,totalTime:0}))},[o]),X=h.useCallback(()=>{if(t.length===0){I("没有可导出的数据","error");return}try{const d=ve(t,"图片处理结果");I(`导出成功！文件名：${d}`,"success")}catch(d){I(`导出失败：${d.message}`,"error")}},[t,I]),ee=h.useCallback(()=>{if(t.length===0){I("没有可导出的数据","error");return}try{const d=Ne(t,"处理统计摘要",L);I(`导出成功！文件名：${d}`,"success")}catch(d){I(`导出失败：${d.message}`,"error")}},[t,L,I]),U=h.useCallback(async(d=!1)=>{var S;if(s){a(!0),k.current=!1,f.current=new AbortController,d?l.current===null&&L.startTime&&(l.current=L.startTime):(l.current=Date.now(),R(j=>({...j,startTime:l.current,endTime:null})));try{let j,E=0;if(d&&u.current.length>0){if(j=u.current.map(w=>({url:w.url,rowIndex:w.rowIndex,columnName:w.columnName,correctAnswer:w.correctAnswer})),E=u.current.findIndex(w=>w.status==="pending"),E===-1){alert("没有待处理的项目"),a(!1);return}}else{if(j=await fe(s),j.length===0){alert('未在Excel中找到包含"截图链接"字样的列或该列没有数据'),a(!1);return}const w=j.map(M=>({...M,status:"pending"}));u.current=w,n([...w])}for(let w=E;w<j.length;w++){if(k.current){console.log("用户终止处理"),u.current[w]={...u.current[w],status:"pending"},n([...u.current]);break}const M=j[w];u.current[w]={...u.current[w],status:"processing"},n([...u.current]);try{const T=await ke(M.url,(S=f.current)==null?void 0:S.signal);if(k.current){u.current[w]={...u.current[w],status:"pending"},n([...u.current]);break}let z;if(M.correctAnswer!==void 0){const B=typeof T=="object"&&T.lijie?T.lijie:typeof T=="string"?T:JSON.stringify(T),ne=B.includes("合格")&&!B.includes("不合格"),oe=B.includes("不合格"),ae=ne&&!oe,ce=M.correctAnswer===1;z=ae===ce}u.current[w]={...u.current[w],status:"success",result:T,isCorrect:z},n([...u.current])}catch(T){u.current[w]={...u.current[w],status:"error",error:ye(T)},n([...u.current])}}}catch(j){j.name!=="AbortError"&&alert(`处理失败: ${j.message}`)}finally{if(f.current=null,a(!1),i(!1),l.current!==null){const j=Date.now();R(E=>({...E,endTime:j,totalTime:j-l.current}))}}}},[s]),se=h.useCallback(()=>{i(!0),k.current=!0,f.current&&(f.current.abort(),console.log("已中断API调用"));const d=setInterval(()=>{(!k.current||!o)&&(i(!1),clearInterval(d))},100)},[o]),te=h.useCallback(()=>{U(!0)},[U]),re=t.length>0?(t.filter(d=>d.status==="success").length+t.filter(d=>d.status==="error").length)/t.length*100:0;return e.jsxs("div",{className:"app-container",children:[A&&e.jsx(Le,{message:A.message,type:A.type,onClose:()=>F(null)}),e.jsx("div",{className:"app-header",children:e.jsx("h1",{className:"app-title",children:"AI审核图片工具"})}),e.jsxs("div",{className:"main-content",children:[e.jsx(be,{file:s,isProcessing:o,resultsLength:t.length,onFileSelect:q,onProcessImages:U,onReupload:J,onStop:se,onContinue:te}),t.length>0&&e.jsx(Ce,{results:t,filter:c,setFilter:v,currentPage:m,pageSize:x,onPageChange:N,onReupload:J,onRestart:Y,onExportResults:X,onExportSummary:ee,isProcessing:o,progress:re,onImageClick:b}),t.length===0&&s&&!o&&e.jsx("div",{className:"empty-state",children:e.jsx("div",{className:"empty-text",children:'点击"开始处理"按钮来处理Excel中的图片链接'})}),g&&e.jsx(Se,{imageUrl:g,onClose:()=>b(null)}),p&&e.jsx(Ee,{})]})]})}V.createRoot(document.getElementById("root")).render(e.jsx(le.StrictMode,{children:e.jsx(Te,{})}));
